<!-- Copyright(c) ZenML GmbH 2024. All Rights Reserved.
Licensed under the Apache License, Version 2.0(the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at:

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
or implied.See the License for the specific language governing
permissions and limitations under the License. -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZenML Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                      zenml: '#7a3ef8',
                      gray: '#e7e5e4',
                      mutedText: '#707070'
                    },
                    fontFamily: {
                        'plus-jakarta': ['"Plus Jakarta Sans"', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <style>
      body {
        background-color: var(--vscode-editor-background);
        color: var(--vscode-editor-foreground);
      }
      ul {
        color:black !important;
      }
      form {
        display: contents;
      }
      #chatForm {
        background: var(--vscode-input-background);
        border: 1px solid var(--vscode-input-border);
      }
      #chatMessages {
        color: var(--vscode-editor-foreground);
      }
      #messageInput {
        color: var(--vscode-input-foreground);
        background-color: var(--vscode-input-background);
      }
      .rounded-lg {
        background-color: var(--vscode-button-background);
        color: var(--vscode-editor-foreground);
      }
      .rounded-lg:hover {
        background-color: var(--vscode-button-hoverBackground);
      }
      .hide {
        display: none;
      }
      .tree-view {
            background-color: var(--vscode-editor-background);
            color: var(--vscode-editor-foreground);
            width: 256px;
            max-height: 300px;
            overflow: auto;
            border: 2px var(--vscode-editor-foreground) solid;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .tree-item {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .tree-item:hover {
          background-color: var(--vscode-list-background);
        }
        .tree-item-content {
            display: flex;
            align-items: center;
            flex-grow: 1;
            padding: 2px 8px;
        }
        .tree-item-icon {
            width: 16px;
            height: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center; 
        }
        .tree-item-name {
            font-size: 14px;
            color: var(--vscode-editor-foreground);
            margin-left: 4px;
            flex-grow: 1;
        }
        .tree-item-children {
            display: none;
            width: 100%;
        }
        .tree-item-children.open {
            display: block;
        }
        .tree-item-wrapper {
            display: flex;
            flex-direction: column;
            width: 100%;
        }
        .tree-item-checkbox {
            width: 16px;
            height: 16px;
            margin-left: 8px;
        }
   </style>
</head>
<body class="font-plus-jakarta">
  <div class="container mx-auto px-4 py-8 max-w-4xl">
    <h1 class="text-3xl font-bold text-center text-zenml mb-8">ZenML Chat</h1>
    
    <div class="mb-6">
      <div class="relative">
          <form id="chatForm" class="flex items-center rounded-full shadow-sm">
              <div class="relative">
                  <button type="button" id="optionsToggle" class="p-2 text-gray-400 hover:text-zenml focus:outline-none">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                      </svg>
                  </button>
                  <div id="optionsDropdown" class="absolute left-8 top-0 mt-2 hidden z-10">
                      <div id="tree-view" class="tree-view">${treeItemHtml}</div>
                  </div>
              </div>
              <input type="text" id="messageInput" name="messageInput" class="flex-grow p-3 focus:outline-none" placeholder="Type your message...">
              <button type="submit" id="sendMessage" class="p-2 text-zenml hover:text-purple-700 focus:outline-none">
                  <svg aria-label="send" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 -960 960 960" class="fill-current">
                      <path d="M120-160v-240l320-80-320-80v-240l760 320-760 320Z"></path>
                  </svg>
              </button>
              <button id="clearChat">
                Clear Chat
              </button>
          </form>
      </div>
      <div id="chatMessages" class="space-y-4 mb-4 mt-4">${chatLogHtml}</div>
      <div id="sampleQuestions" class="flex flex-col mt-auto md:mt-0">
        <div class="md:col-span-4 md:col-start-2 md:flex md:justify-center">
          <div class="w-full px-6 md:grid md:grid-cols-3 space-y-2 md:space-y-0">
            <div class="flex flex-row items-center">
              <div class="rounded-lg bg-card text-card-foreground md:h-auto grow text-sm overflow-hidden dark:bg-transparent dark:hover:bg-shallow hover:cursor-pointer border md:border-none shadow-sm md:shadow-none">
                <div class="px-4 md:text-center">
                  <p>What can this chat do?</p>
                </div>
              </div>
              <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" class="hidden md:block size-6 text-gray">
                <path d="M7.5 2C7.77614 2 8 2.22386 8 2.5L8 12.5C8 12.7761 7.77614 13 7.5 13C7.22386 13 7 12.7761 7 12.5L7 2.5C7 2.22386 7.22386 2 7.5 2Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path>
              </svg>
            </div>
            <div class="flex flex-row items-center">
              <div class="rounded-lg bg-card text-card-foreground md:h-auto grow text-sm overflow-hidden dark:bg-transparent dark:hover:bg-shallow hover:cursor-pointer border md:border-none shadow-sm md:shadow-none">
                <div class="px-4 md:text-center">
                  <p>Help me improve my stack</p>
                </div>
              </div>
              <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" class="hidden md:block size-6 text-gray">
                <path d="M7.5 2C7.77614 2 8 2.22386 8 2.5L8 12.5C8 12.7761 7.77614 13 7.5 13C7.22386 13 7 12.7761 7 12.5L7 2.5C7 2.22386 7.22386 2 7.5 2Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path>
              </svg>
            </div>
            <div class="flex flex-row items-center">
              <div class="rounded-lg bg-card text-card-foreground md:h-auto grow text-sm overflow-hidden dark:bg-transparent dark:hover:bg-shallow hover:cursor-pointer border md:border-none shadow-sm md:shadow-none">
                <div class="px-4 md:text-center">
                  <p>Generate a summary of my stats</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="${jsUri}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      const optionsToggle = document.getElementById('optionsToggle');
      const optionsDropdown = document.getElementById('optionsDropdown');

      optionsToggle.addEventListener('click', () => {
        optionsDropdown.classList.toggle('hidden');
      });

      document.addEventListener('click', (event) => {
        if (!optionsToggle.contains(event.target) && !optionsDropdown.contains(event.target)) {
          optionsDropdown.classList.add('hidden');
        }
      });

      const treeItemsWithChildren = Array.from(document.querySelectorAll('div.tree-item-wrapper'))
      .filter(treeItemsWithChildren => treeItemsWithChildren.querySelector('div.tree-item-children') !== null);

      treeItemsWithChildren.forEach(wrapper => {
        wrapper.querySelector('div.tree-item-content').addEventListener('click', function(event) {
          const checkboxEl = this.querySelector('input[type="checkbox"]');
          const childrenEl = this.parentNode.querySelector('div.tree-item-children');
          const chevronEl = this.querySelector('span.tree-item-icon');

          if (event.target !== checkboxEl) {
            event.stopPropagation();
            childrenEl.classList.toggle('open');


            if (childrenEl.classList.contains('open')) {
              chevronEl.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#808080" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>';
            } else {
              chevronEl.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#808080" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>';
            }
          }
        });
      });
    });
  </script>
</body>
</html>
